Code is modified based on original version from https://github.com/didriknielsen/argmax_flows.